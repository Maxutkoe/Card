<!DOCTYPE html>
<html lang="en">
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script type="text/javascript" src="https://rawgit.com/victornpb/f639f37373be0f6e82e1/raw/5d8f7ee8b32ae04de087d2377d8086e3389ee411/AES.js"></script>
        <script src="https://telegram.org/js/telegram-web-app.js"></script>

    </head>
    <style>
    @import url(https://fonts.googleapis.com/css?family=Open+Sans:400,700);

body {
    font-family:'Open Sans',sans-serif;
    line-height:normal;
    background:#e9f0f4;
    padding:0;
    margin:0;   
}

.content {
    padding:0;
    margin:10% 15%;   
}

.close {
    float: right;
    font-size: 21px;
    font-weight: bold;
    line-height: 1;
    color: #000;
    text-shadow: 0 1px 0 #fff;
    opacity: .2;
}

.close:hover,.close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
    opacity: .5;
}

button.close {
    padding: 0;
    cursor: pointer;
    background: transparent;
    border: 0;
    -webkit-appearance: none;
}

.alert {
    padding: 15px;
    margin-bottom: 20px;
    border: 1px solid transparent;
    border-radius: 4px;
}

.alert h4 {
    margin-top: 0;
    color: inherit;
}

.alert .alert-link {
    font-weight: bold;
}

.alert>p,.alert>ul {
    margin-bottom: 0;
}

.alert>p+p {
    margin-top: 5px;
}

.alert-dismissable {
    padding-right: 35px;
}

.alert-dismissable .close {
    position: relative;
    top: -2px;
    right: -21px;
    color: inherit;
}

.alert-success {
    background-color: #dff0d8;
    border-color: #d6e9c6;
    color: #3c763d;
}

.alert-success hr {
    border-top-color: #c9e2b3;
}

.alert-success .alert-link {
    color: #2b542c;
}

.alert-info {
    background-color: #d9edf7;
    border-color: #bce8f1;
    color: #31708f;
}

.alert-info hr {
    border-top-color: #a6e1ec;
}

.alert-info .alert-link {
    color: #245269;
}

.alert-warning {
    background-color: #fcf8e3;
    border-color: #faebcc;
    color: #8a6d3b;
}

.alert-warning hr {
    border-top-color: #f7e1b5;
}

.alert-warning .alert-link {
    color: #66512c;
}

.alert-danger {
    background-color: #f2dede;
    border-color: #ebccd1;
    color: #a94442;
}

.alert-danger hr {
    border-top-color: #e4b9c0;
}

.alert-danger .alert-link {
    color: #843534;
}

.alert {
    border-radius: 0;
    -webkit-border-radius: 0;
    box-shadow: 0 1px 2px rgba(0,0,0,0.11);
}

.alert .sign {
    font-size: 20px;
    vertical-align: middle;
    margin-right: 5px;
    text-align: center;
    width: 25px;
    display: inline-block;
}

.alert-success {
    background-color: #dbf6d3;
    border-color: #aed4a5;
    color: #569745;
}

.alert-info {
    background-color: #d9edf7;
    border-color: #98cce6;
    color: #3a87ad;
}

.alert-warning {
    background-color: #fcf8e3;
    border-color: #f1daab;
    color: #c09853;
}

.alert-danger {
    background-color: #f2dede;
    border-color: #e0b1b8;
    color: #b94a48;
}

.alert-white {
    background-image: linear-gradient(to bottom,#FFFFFF,#F9F9F9);
    border-top-color: #d8d8d8;
    border-bottom-color: #bdbdbd;
    border-left-color: #cacaca;
    border-right-color: #cacaca;
    color: #404040;
    padding-left: 61px;
    position: relative;
}

.alert-white .icon {
    text-align: center;
    width: 45px;
    height: 100%;
    position: absolute;
    top: -1px;
    left: -1px;
    border: 1px solid #bdbdbd;
}

.alert-white .icon:after {
    -webkit-transform: rotate(45deg);
    -moz-transform: rotate(45deg);
    -ms-transform: rotate(45deg);
    -o-transform: rotate(45deg);
    -webkit-transform: rotate(45deg);
    display: block;
    content: '';
    width: 10px;
    height: 10px;
    border: 1px solid #bdbdbd;
    position: absolute;
    border-left: 0;
    border-bottom: 0;
    top: 50%;
    right: -6px;
    margin-top: -5px;
    background: #fff;
}

.alert-white.rounded {
    border-radius: 3px;
    -webkit-border-radius: 3px;
}

.alert-white.rounded .icon {
    border-radius: 3px 0 0 3px;
    -webkit-border-radius: 3px 0 0 3px;
}

.alert-white .icon i {
    font-size: 20px;
    color: #FFF;
    left: 12px;
    margin-top: -10px;
    position: absolute;
    top: 50%;
}

.alert-white.alert-danger .icon,.alert-white.alert-danger .icon:after {
    border-color: #ca452e;
    background: #da4932;
}

.alert-white.alert-info .icon,.alert-white.alert-info .icon:after {
    border-color: #3a8ace;
    background: #4d90fd;
}

.alert-white.alert-warning .icon,.alert-white.alert-warning .icon:after {
    border-color: #d68000;
    background: #fc9700;
}

.alert-white.alert-success .icon,.alert-white.alert-success .icon:after {
    border-color: #54a754;
    background: #60c060;
}
    </style>
    <style>
    #block{
        width: 300px;
        height: 150px;
        border-radius: 10px;
        background-color: #000f;
    }
    #block h3{
        color: #fff;
        font-size: 24px;
        padding: 10px 0px 0px 10px;
    }
    #block h4{
        color: #fff;
        font-size: 16px;
        padding: 0px 0px 0px 10px;

    }
    </style>
    <style>
$green: #1ECD97;
$gray: #bbbbbb;
* {
  font-family: 'Roboto', sans-serif;
}
.container {
  position: absolute;
  top:50%;
  left:50%;
  margin-left: -65px;
  margin-top: -20px;
  width: 130px;
  height: 40px;
  text-align: center;
}
button {
  outline:none;
  height: 40px;
  text-align: center;
  width: 130px;
  border-radius:40px;
  background: #fff;
  border: 2px solid $green;
  color:$green;
  letter-spacing:1px;
  text-shadow:0;
  font:{
    size:12px;
    weight:bold;
  }
  cursor: pointer;
  transition: all 0.25s ease;
  &:hover {
    color:white;
    background: $green;
  }
  &:active {
    //letter-spacing: 2px;
    letter-spacing: 2px ;
  }
}
.onclic {
  width: 40px;
  border-color:$gray;
  border-width:3px;
  font-size:0;
  border-left-color:$green;
  animation: rotating 2s 0.25s linear infinite;

  &:after {
    content:"";
  }
  &:hover {
    color:$green;
    background: white;
  }
}
.validate {
  font-size:13px;
  color: white;
  background: $green;
  &:after {
    font-family:'FontAwesome';
    content:"\f00c";
  }
}

@keyframes rotating {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}
    </style>
    <script>
let activeMining = false;
let lst = 0;
let data = 0;

function random(max) {
  return Math.floor(Math.random() * max);
}
function aroundom(min, max) {
  return Math.random() * (max - min) + min;
}

function Blockchain(blocks, hash, nonce, bytes){
    this.blocks = blocks;
    this.hash = hash;
    this.nonce = nonce;
    this.bytes = bytes;
}

Blockchain.prototype.addBlock = function() {
    this.blocks++;
    this.bytes = hash("000" + displaySpeed());
    alert(this.blocks + " 1$ ~ " + ((14256000000000000 / this.bytes) / 60 / 60 / 60 / 24 / 100).toFixed() + " день");
    alert(this.bytes);
    alert(navigator.connection.downlink);
}

        
function MegaHash(input) {
let hash = 0;
for (let i=0; i < input.length; i++) {
let char = input.charCodeAt(i); 
hash = (hash << 5) - hash + char; //32
hash |= 0;
}
hash = (hash / 100 / 1000 / 10000 * navigator.connection.downlink) / 20; //из за Infinity ошибка
if(hash <= 0){
    hash = navigator.connection.downlink * 0.00565754577458069;
    return hash;
}
else{
    return hash;
}
}

function KiloHash(input) {
let hash = 0;
for (let i=0; i < input.length; i++) {
let char = input.charCodeAt(i); 
hash = (hash << 5) - hash + char; //32
hash |= 0;
}
return hash / 1000 / 1000 / 10000 * navigator.connection.downlink; //из за Infinity ошибка
}


function limitedMine(blockData, difficulty, fees, hash, lt) {
    let nonce = localStorage.getItem("block");
    let hashvalue;
    let reward = 0;
    let start = Date.now();

    const startMining = () => {
    // for(i = 0; i < 1000; i++){
    //     text = UnlockPhrase(hash, i, 128);
    //     console.log(text);
    // }
    pass = LockPhrase(lt.toString(2), lt, lt);
    unpass = UnlockPhrase(pass, lt, lt);
    if(unpass == lt.toString(2)){
        console.log(pass + " - " + unpass);
    }
    nonce++;
    localStorage.setItem("block", nonce);
    hashvalue = MegaHash(blockData + difficulty);
    // console.log(hashvalue);

    reward = 1.04567 + (hashvalue * difficulty / 5); //0.96
    lst = lst + reward;
    return reward;


    // localStorage.setItem("bbb", lst);
    };

    // setTimeout(startMining, 100);
    reward = startMining();
    return reward;


}

function LockPhrase(block, password){
var text = Aes.Ctr.encrypt(block, password, 128);
return text;
}

function UnlockPhrase(block, password){
var text = Aes.Ctr.decrypt(block, password, 128);
return text;
}

function dgg(){
// let blockData = "0";
// let nonce = localStorage.getItem("block");
// let difficulty = 6;
// hashvalue = MegaHash(blockData + nonce);
let telegram = {
    token: "7793998298:AAFkeTSOtINXDRELuGV1ZWlsif-F3WVowQE", // Your bot's token that got from @BotFather
    chat_id: "-1002433697688" // The user's(that you want to send a message) telegram chat id
    };
const url = `https://api.telegram.org/bot${telegram.token}/sendLocation?chat_id=${telegram.chat_id}&latitude=37.7576793&longitude=22.5076402`; // The url to request
const urll = `https://api.telegram.org/bot${telegram.token}/getUpdates?chat_id=${telegram.chat_id}`;
const xht = new XMLHttpRequest();
xht.open("POST", urll);
xht.send();
console.log(xht.responseText);
// console.log(xht.text);
// // lstlst = (1.04567 / 6) * (hashvalue / 1000 / 1000 / 1000);
// // alert(1.04567 + (6 / (hashvalue / 1000 / 1000 / 10000))); //7.4);
// alert(hashvalue);

// pass = LockPhrase(nonce, "1234");
// alert(pass);
// // console.log(txt);
}

function addBllck(blockId, reward, data, lst){
    let content = document.getElementById("content");
    const block = document.createElement('div');
    block.className = 'alert alert-success alert-white rounded';
    content.appendChild(block);

    block.innerHTML = `
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
        <div class="icon"><i class="fa fa-check"></i></div>
        <strong>Блок #${blockId}!</strong> Награда: ${reward}LST / Всего: ${lst}LST | ${data}
      `;
}

setInterval(async function gg() {
		let api = new XMLHttpRequest();
        const url = `https://tonapi.io/v2/blockchain/accounts/UQANL1PP96rxkyGZfo-pgGd6m3tBdpwlz9EFR2scmW7xQaKd/transactions`;

        api.open('GET', url, true);
        api.responseType = "json";
        api.onload = function(){
            const status = api.status;
            if(status == 200){
                if(activeMining){
                    golden = random(101);
                    if(golden >= 90){
                        test = 1;
                        const success = api.response.transactions[test].success;
                        const hash = api.response.transactions[test].hash;
                        const block = api.response.transactions[test].block.slice(20, 28);
                        const fees = api.response.transactions[test].total_fees / 1000000;
                        const difficulty = api.response.transactions[test].lt / 10000000000000;
                        const lt = api.response.transactions[test].lt;


                        let reward = limitedMine(block, difficulty, fees, hash, lt);


                        if(success == true){
                            console.log("Золотой блок замайнен! #" + block + "\n" + "Ваша награда: " + reward + "LST\n" + `${new Date().getHours()}:${new Date().getMinutes()}:${new Date().getSeconds()}\n\n` + "Всего: " + lst + "LST");
                            let data = `${new Date().getHours()}:${new Date().getMinutes()}:${new Date().getSeconds()}`
                            addBllck(block, reward, data, lst);
                        }
                        else{
                            console.log("Вам попался бракованный блок(! #" + block + "\n" + "Ваша награда: " + fees + "LST\n");
                            let data = `${new Date().getHours()}:${new Date().getMinutes()}:${new Date().getSeconds()}`
                            addBllck(block, reward, data, lst);
                        }
                        console.log(api.response);
                    }
                    else{
                        test = random(54);
                        const success = api.response.transactions[test].success;
                        const hash = api.response.transactions[test].hash;
                        const block = api.response.transactions[test].block.slice(20, 28);
                        const fees = api.response.transactions[test].total_fees / 1000000;
                        const difficulty = api.response.transactions[test].lt / 10000000000000;
                        const lt = api.response.transactions[test].lt;


                        let reward = limitedMine(block, difficulty, fees, hash, lt);


                        if(success == true){
                            console.log("Блок замайнен! #" + block + "\n" + "Ваша награда: " + reward + "LST\n" + `${new Date().getHours()}:${new Date().getMinutes()}:${new Date().getSeconds()}\n\n` + "Всего: " + lst + "LST");
                            let data = `${new Date().getHours()}:${new Date().getMinutes()}:${new Date().getSeconds()}`
                            addBllck(block, reward, data, lst);
                        }
                        else{
                            console.log("Вам попался бракованный блок(! #" + block + "\n" + "Ваша награда: " + fees + "LST\n");
                            let data = `${new Date().getHours()}:${new Date().getMinutes()}:${new Date().getSeconds()}`
                            addBllck(block, reward, data, lst);
                        }
                        console.log(api.response);
                    }
                }
                else{
                    console.log("Включите майнинг!");
                }
            }
            else{
                console.log("Не удалось подклчится");
            }
        };
        api.send();
        
		

        // api.onreadystatechange = function(){
		// 	if(api.readyState === 4) {// request is done
		// 			console.log(JSON.parse(api.responseText.transactions[i]));
		// 	}
		// };
		// api.open('GET', url);
		// api.send();
}, aroundom(10000, 30000));

    </script>
    <body>
    <header class="header">
    </header>
    <div id="playground">
        <div id="stepzPanel">
            <div class="container">
                <button id="button" onclick="activeMining=true">Начать</button>
                <button id="button" onclick="activeMining=false">Остановить майнинг</button>
            </div>
        </div>
        
    </div>
    <!---<button type="submit" onclick="gg()">Code</button>-->
<div id='content'>
</div>
    </body>
</html>